<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ“Š Resultados - Extrator de Contracheques</title>
    <link rel="icon" href="{{ url_for('static', filename='img/logo_maida.png') }}" />
    
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components/navbar.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/pages/calculadora.css') }}">
</head>
<body class="page-resultado">
    {% include 'components/_preloader.html' %}
    {% include 'components/_navbar.html' %}

    <div class="scrollbar-container">
        <div class="scrollbar-thumb" id="scrollThumb"></div>
    </div>
    
    <div class="container-centralizado">
        <h1>ðŸ“Š Resumo Geral por Ano</h1>

        <div class="year-selector">
            <label for="anoSelecionado">Filtrar por ano:</label>
            <select id="anoSelecionado">
                <option value="todos">Todos os anos</option>
                {% for ano in resultados_por_ano.keys()|sort(reverse=True) %}
                    <option value="{{ ano }}">{{ ano }}</option>
                {% endfor %}
            </select>
        </div>

        {% if resultados_por_ano %}
            {% for ano, dados_ano in resultados_por_ano.items()|sort(reverse=True) %}
                <div class="ano-container" data-ano="{{ ano }}">
                    <h2>Ano: {{ ano }}</h2>
                    
                    <table>
                        <!-- CORREÃ‡ÃƒO: Usando .get(chave, 0) para checar os valores de forma segura -->
                        {% if dados_ano.geral.get('titular', 0) > 0 %}
                            <tr><th scope="col">Titular</th><td>R$ {{ "%.2f"|format(dados_ano.geral.get('titular', 0)) }}</td></tr>
                        {% endif %}
                        {% if dados_ano.geral.get('conjuge', 0) > 0 %}
                            <tr><th scope="col">CÃ´njuge</th><td>R$ {{ "%.2f"|format(dados_ano.geral.get('conjuge', 0)) }}</td></tr>
                        {% endif %}
                        {% if dados_ano.geral.get('dependente', 0) > 0 %}
                            <tr><th scope="col">Dependente</th><td>R$ {{ "%.2f"|format(dados_ano.geral.get('dependente', 0)) }}</td></tr>
                        {% endif %}
                        {% if dados_ano.geral.get('agregado_jovem', 0) > 0 %}
                            <tr><th scope="col">Agregado Jovem</th><td>R$ {{ "%.2f"|format(dados_ano.geral.get('agregado_jovem', 0)) }}</td></tr>
                        {% endif %}
                        {% if dados_ano.geral.get('agregado_maior', 0) > 0 %}
                            <tr><th scope="col">Agregado Maior</th><td>R$ {{ "%.2f"|format(dados_ano.geral.get('agregado_maior', 0)) }}</td></tr>
                        {% endif %}
                        {% if dados_ano.geral.get('plano_especial', 0) > 0 %}
                            <tr><th scope="col">Plano Especial</th><td>R$ {{ "%.2f"|format(dados_ano.geral.get('plano_especial', 0)) }}</td></tr>
                        {% endif %}
                        {% if dados_ano.geral.get('coparticipacao', 0) > 0 %}
                            <tr><th scope="col">Co-participaÃ§Ã£o</th><td>R$ {{ "%.2f"|format(dados_ano.geral.get('coparticipacao', 0)) }}</td></tr>
                        {% endif %}
                        {% if dados_ano.geral.get('retroativo', 0) > 0 %}
                            <tr><th scope="col">Retroativo</th><td>R$ {{ "%.2f"|format(dados_ano.geral.get('retroativo', 0)) }}</td></tr>
                        {% endif %}
                        {% if dados_ano.geral.get('restituicao', 0) > 0 %}
                            <tr><th scope="col">RestituiÃ§Ã£o</th><td>R$ {{ "%.2f"|format(dados_ano.geral.get('restituicao', 0)) }}</td></tr>
                        {% endif %}
                        {% if dados_ano.geral.get('parcela_risco_titular', 0) > 0 %}
                            <tr><th scope="col">Parcela de Risco Titular</th><td>R$ {{ "%.2f"|format(dados_ano.geral.get('parcela_risco_titular', 0)) }}</td></tr>
                        {% endif %}
                        {% if dados_ano.geral.get('parcela_risco_dependente', 0) > 0 %}
                            <tr><th scope="col">Parcela de Risco Dependente</th><td>R$ {{ "%.2f"|format(dados_ano.geral.get('parcela_risco_dependente', 0)) }}</td></tr>
                        {% endif %}
                        {% if dados_ano.geral.get('parcela_risco_conjuge', 0) > 0 %}
                            <tr><th scope="col">Parcela de Risco CÃ´njuge</th><td>R$ {{ "%.2f"|format(dados_ano.geral.get('parcela_risco_conjuge', 0)) }}</td></tr>
                        {% endif %}
                        {% if dados_ano.geral.get('parcela_risco_agregado', 0) > 0 %}
                            <tr><th scope="col">Parcela de Risco Agregado</th><td>R$ {{ "%.2f"|format(dados_ano.geral.get('parcela_risco_agregado', 0)) }}</td></tr>
                        {% endif %}
                        
                        <!-- Linha do Total do Ano -->
                        <tr class="total-geral">
                            <th scope="col">Total do Ano</th>
                            <td>R$ {{ "%.2f"|format(dados_ano.get('total_ano', 0)) }}</td>
                        </tr>
                    </table>
                    <hr>
                </div>
            {% endfor %}
        {% else %}
            <p>Nenhum resultado encontrado.</p>
        {% endif %}

        <div class="total-geral-container">
            <h3>Total Geral de Todos os Anos</h3>
            <p>R$ {{ "%.2f"|format(total_geral) }}</p>
        </div>

        <div class="btn-container">
            <a href="{{ url_for('mostrar_analise_detalhada') }}" class="btn btn-success">
                ðŸ”¬ AnÃ¡lise AvanÃ§ada
            </a>
            <a href="{{ url_for('detalhes_mensais') }}" class="btn btn-secondary">
                ðŸ“… Detalhes por MÃªs
            </a>
            <a href="{{ url_for('calculadora_index') }}" class="btn btn-primary">
                ðŸ”„ Novo CÃ¡lculo
            </a>
        </div>
    </div>
    
    {% include 'components/_footer.html' %}
    
    <script src="{{ url_for('static', filename='js/main.js') }}" defer></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const anoSelecionado = document.getElementById('anoSelecionado');
            
            anoSelecionado.addEventListener('change', function() {
                const ano = this.value;
                const anoContainers = document.querySelectorAll('.ano-container');
                const totalGeralContainer = document.querySelector('.total-geral-container');
                
                totalGeralContainer.style.display = (ano === 'todos') ? 'block' : 'none';

                anoContainers.forEach(container => {
                    if (ano === 'todos' || container.dataset.ano === ano) {
                        container.style.display = 'block';
                    } else {
                        container.style.display = 'none';
                    }
                });
            });
            
            anoSelecionado.dispatchEvent(new Event('change'));
        });
    </script>
</body>
</html>
