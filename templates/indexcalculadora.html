{% extends "base.html" %}

{% block content %}
<div class="borda-animada">
    <div class="content-box">
        <h1><strong>√Årea ACR</strong></h1>

        {% with messages = get_flashed_messages() %}
            {% if messages %}
                <div class="alert-messages">
                    {% for message in messages %}
                        <div class="alert">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
        
        <form action="{{ url_for('upload') }}" method="post" enctype="multipart/form-data" id="upload-form">
            <input type="file" name="files" id="file-upload" multiple hidden aria-label="Selecionar arquivos" />
            <label for="file-upload" class="upload-btn">üìÅ Escolher Arquivos</label>
            <p id="file-name" class="file-name" aria-live="polite">Nenhum arquivo selecionado</p>
            <button type="button" class="process-btn">Processar</button>
            <progress id="upload-progress" value="0" max="100" hidden></progress>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const fileInput = document.getElementById('file-upload');
        const fileNameText = document.getElementById('file-name');
        const processBtn = document.querySelector('.process-btn');
        const uploadForm = document.getElementById('upload-form');

        fileInput.addEventListener('change', function() {
            if (this.files.length === 0) {
                fileNameText.textContent = 'Nenhum arquivo selecionado';
                return;
            }
            const invalidFiles = Array.from(this.files).filter(file => file.type !== 'application/pdf');
            if (invalidFiles.length > 0) {
                fileNameText.textContent = 'Por favor, selecione apenas arquivos PDF.';
                this.value = '';
                return;
            }
            fileNameText.textContent = this.files.length === 1 ? this.files[0].name : `${this.files.length} arquivos PDF selecionados`;
        });

        processBtn.addEventListener('click', function() {
            if (!fileInput.files || fileInput.files.length === 0) {
                fileNameText.textContent = 'Por favor, selecione pelo menos um arquivo PDF.';
                return;
            }
            this.disabled = true;
            this.innerHTML = `<span class="spinner"></span> Processando...`;
            uploadForm.submit(); 
        });
    });
</script>
{% endblock %}
