{% extends "base.html" %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/calculadora.css') }}">
<style>
    :root {
    --maida-azul: #224aa2;
    --maida-rosa: #ff6b8b;
    --maida-amarelo: #ffd166;
    --texto-escuro: #333;
    --texto-cinza: #666;
    --sombra-padrao: 0 5px 15px rgba(0,0,0,0.1);
    --transicao-padrao: all 0.3s ease;
}
    .page-header {
        text-align: center;
        margin-bottom: 30px;
    }
    
    .page-header img {
        max-width: 180px;
        height: auto;
        margin-bottom: 20px;
    }
       
    .calculator-container {
        background: white;
        border-radius: 15px;
        padding: 40px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        width: 90%;
        max-width: 600px;  /* Largura mais estreita para melhor leitura */
        margin: 40px auto;
        text-align: center;  /* Centraliza todo o conte√∫do */
    }
    
    .calculator-header {
        margin-bottom: 30px;
    }
    
    .calculator-header h1 {
        color: var(--maida-azul);
        font-size: 2rem;
        margin-bottom: 5px;  /* Espa√ßo reduzido */
    }
    
    .calculator-header p {
        color: #666;
        font-size: 1rem;
        margin-bottom: 30px;
    }
    
    .upload-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 15px;
        margin-top: 20px;
    }
    
    .file-name {
        color: #666;
        font-size: 0.9rem;
        margin: 10px 0;
    }
    .resultados-container {
    margin-top: 40px;
    padding: 30px;
    background: #f8f9fa;
    border-radius: 15px;
}

.resumo-container {
    display: flex;
    justify-content: center;
    gap: 30px;
    margin: 25px 0;
}

.resumo-item {
    background: white;
    padding: 20px;
    border-radius: 10px;
    min-width: 200px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
}

.botoes-container {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-top: 30px;
}
    .btn-voltar, .btn-detalhes {
    padding: 12px 25px;
    border-radius: 8px;
    border: none;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 10px;
}

.btn-voltar {
    background: var(--maida-amarelo);
    color: var(--maida-azul);
}

.btn-detalhes {
    background: var(--maida-azul);
    color: white;
}
    .spinner-container {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.spinner {
    display: inline-block;
    width: 18px;
    height: 18px;
    border: 3px solid rgba(255,255,255,0.3);
    border-radius: 50%;
    border-top-color: white;
    animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}
</style>
{% endblock %}

{% block content %}
<div class="page-inicio">
    <div class="page-header">
        <img src="{{ url_for('static', filename='img/logo_maida.png') }}" 
             alt="Logo Maida Health" 
             class="logo-calculadora">
    </div>
    <div class="calculator-container">
        <div class="calculator-header">
            <h1>√Årea ACR</h1>
            <p>Anexe os contracheques</p>  <!-- Texto simplificado -->
        </div>
        
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                <div class="alert-messages">
                    {% for message in messages %}
                        <div class="alert">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
        
        <div class="upload-container">
            <form action="{{ url_for('upload') }}" method="post" enctype="multipart/form-data" id="upload-form">
                <input type="file" name="files" id="file-upload" multiple hidden aria-label="Selecionar arquivos" />
                <label for="file-upload" class="upload-btn">üìÅ Escolher Arquivos PDF</label>
                <p id="file-name" class="file-name">Nenhum arquivo selecionado</p>
                <button type="button" class="process-btn">Processar</button>
                <progress id="upload-progress" value="0" max="100" hidden></progress>
            </form>
        </div>
            <!-- Adicione logo ap√≥s o formul√°rio -->
{% if arquivos_processados and resultados %}
<div class="resultados-container">
    <h2>Resultados do Processamento</h2>
    
    <div class="resumo-container">
        <div class="resumo-item">
            <h3>Total de Proventos</h3>
            <p>R$ {{ "%.2f"|format(resultados.total_proventos) }}</p>
        </div>
        
        <div class="resumo-item">
            <h3>Arquivos Processados</h3>
            <p>{{ resultados.quantidade_arquivos }}</p>
        </div>
    </div>
    
    <div class="botoes-container">
        <button onclick="location.href='{{ url_for('calculadora') }}'" class="btn-voltar">
            <i class="fas fa-redo"></i> Processar Novos Arquivos
        </button>
        <button class="btn-detalhes" onclick="location.href='{{ url_for('analise_detalhada') }}'">
            <i class="fas fa-chart-bar"></i> Ver An√°lise Detalhada
        </button>
    </div>
    
{% endif %}
        </div>
   
</div>

<!-- Mantenha o mesmo JavaScript -->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const fileInput = document.getElementById('file-upload');
        const fileNameText = document.getElementById('file-name');
        const processBtn = document.querySelector('.process-btn');
        const uploadForm = document.getElementById('upload-form');

        // Atualiza o texto ao selecionar arquivos
        fileInput.addEventListener('change', function() {
            if (this.files.length === 0) {
                fileNameText.textContent = 'Nenhum arquivo selecionado';
                return;
            }
            
            // Verifica se todos s√£o PDFs
            const invalidFiles = Array.from(this.files).filter(file => file.type !== 'application/pdf');
            if (invalidFiles.length > 0) {
                fileNameText.textContent = 'Por favor, selecione apenas arquivos PDF.';
                this.value = '';
                return;
            }
            
            // Atualiza mensagem com nome/quantidade de arquivos
            fileNameText.textContent = this.files.length === 1 
                ? `1 arquivo selecionado: ${this.files[0].name}` 
                : `${this.files.length} arquivos selecionados`;
        });

        // Valida√ß√£o ao clicar em Processar
        processBtn.addEventListener('click', function() {
            if (!fileInput.files || fileInput.files.length === 0) {
                fileNameText.textContent = 'Por favor, selecione pelo menos um arquivo PDF.';
                return;
            }
            
            // Feedback visual durante o processamento
            this.disabled = true;
            this.innerHTML = `
                <div class="spinner-container">
                    <span class="spinner"></span> Processando...
                </div>
            `;
            
            // Submete o formul√°rio
            uploadForm.submit();
        });

        // Tratamento de erro
        uploadForm.addEventListener('error', function() {
            processBtn.disabled = false;
            processBtn.innerHTML = 'Processar';
            fileNameText.textContent = 'Erro no processamento. Tente novamente.';
        });
    }); 
</script>
{% endblock %}
