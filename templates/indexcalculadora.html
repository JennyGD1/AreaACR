{% extends "base.html" %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/calculadora.css') }}">
<style>
    /* Seus estilos existentes permanecem iguais */
    :root {
        --maida-azul: #224aa2;
        --maida-rosa: #ff6b8b;
        --maida-amarelo: #ffd166;
        --texto-escuro: #333;
        --texto-cinza: #666;
        --sombra-padrao: 0 5px 15px rgba(0,0,0,0.1);
        --transicao-padrao: all 0.3s ease;
    }
    
    /* ... (mantenha todos os outros estilos existentes) ... */
</style>
{% endblock %}

{% block content %}
<div class="page-inicio">
    <div class="page-header">
        <img src="{{ url_for('static', filename='img/logo_maida.png') }}" 
             alt="Logo Maida Health" 
             class="logo-calculadora">
    </div>
    <div class="calculator-container">
        <div class="calculator-header">
            <h1>√Årea ACR</h1>
            <p>Anexe os contracheques</p>
        </div>
        
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                <div class="alert-messages">
                    {% for message in messages %}
                        <div class="alert">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
        
        <div class="upload-container">
            <form id="upload-form" method="POST" enctype="multipart/form-data" action="{{ url_for('upload') }}">
                <!-- Input file modificado para m√∫ltiplos arquivos -->
                <input type="file" name="files" id="file-upload" accept=".pdf" multiple required style="display: none;">
                
                <!-- Bot√£o visual personalizado para selecionar arquivo -->
                <label for="file-upload" class="upload-btn">
                    üìÅ Anexar contracheques
                </label>
                
                <!-- Feedback dos nomes dos arquivos (atualizado para m√∫ltiplos) -->
                <div id="file-names" class="file-name">Nenhum arquivo selecionado</div>
                
                <!-- Bot√£o de processar -->
                <button type="submit" class="process-btn" id="submit-btn">
                    Processar
                </button>
                
                <!-- Mensagens de feedback -->
                <div id="upload-feedback" class="feedback-message"></div>
            </form>
        </div>
        
        {% if arquivos_processados and resultados %}
        <div class="resultados-container">
            <h2>Resultados do Processamento</h2>
            
            <div class="resumo-container">
                <div class="resumo-item">
                    <h3>Total de Proventos</h3>
                    <p>R$ {{ "%.2f"|format(resultados.total_proventos) }}</p>
                </div>
                
                <div class="resumo-item">
                    <h3>Arquivos Processados</h3>
                    <p>{{ resultados.quantidade_arquivos }}</p>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const fileInput = document.getElementById('file-upload');
        const fileNamesDisplay = document.getElementById('file-names');
        const submitBtn = document.getElementById('submit-btn');
        const feedbackDiv = document.getElementById('upload-feedback');
        const form = document.getElementById('upload-form');

        // Atualiza os nomes dos arquivos selecionados
        fileInput.addEventListener('change', function() {
            if (this.files && this.files.length > 0) {
                const names = Array.from(this.files).map(file => file.name).join(', ');
                fileNamesDisplay.innerHTML = `
                    <strong>${this.files.length} arquivo(s) selecionado(s):</strong><br>
                    ${names}
                `;
                fileNamesDisplay.style.color = '#224aa2'; // Azul da Maida
            } else {
                fileNamesDisplay.textContent = 'Nenhum arquivo selecionado';
                fileNamesDisplay.style.color = '#666'; // Cinza
            }
        });

        // Valida√ß√£o do formul√°rio
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!fileInput.files || fileInput.files.length === 0) {
                showFeedback('Selecione pelo menos um arquivo PDF antes de processar', 'error');
                return;
            }

            // Verifica se todos os arquivos s√£o PDF
            const invalidFiles = Array.from(fileInput.files).filter(
                file => !file.name.toLowerCase().endsWith('.pdf')
            );
            
            if (invalidFiles.length > 0) {
                showFeedback('Apenas arquivos PDF s√£o permitidos', 'error');
                return;
            }

            // Mostra loading
            submitBtn.disabled = true;
            submitBtn.innerHTML = `
                <span class="spinner"></span> Processando...
            `;

            // Envia o formul√°rio
            this.submit();
        });

        function showFeedback(message, type) {
            feedbackDiv.textContent = message;
            feedbackDiv.className = `feedback-message ${type}`;
        }
    });
</script>
{% endblock %}
