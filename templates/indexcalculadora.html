{% extends "base.html" %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/calculadora.css') }}">
<style>
    /* Seus estilos existentes permanecem iguais */
    :root {
        --maida-azul: #224aa2;
        --maida-rosa: #ff6b8b;
        --maida-amarelo: #ffd166;
        --texto-escuro: #333;
        --texto-cinza: #666;
        --sombra-padrao: 0 5px 15px rgba(0,0,0,0.1);
        --transicao-padrao: all 0.3s ease;
    }
    
    /* ... (mantenha todos os outros estilos existentes) ... */
</style>
{% endblock %}

{% block content %}
<div class="page-inicio">
    <div class="page-header">
        <img src="{{ url_for('static', filename='img/logo_maida.png') }}" 
             alt="Logo Maida Health" 
             class="logo-calculadora">
    </div>
    <div class="calculator-container">
        <div class="calculator-header">
            <h1>√Årea ACR</h1>
            <p>Anexe os contracheques</p>
        </div>
        
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                <div class="alert-messages">
                    {% for message in messages %}
                        <div class="alert">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
        
        <div class="upload-container">
            <form id="upload-form" method="POST" enctype="multipart/form-data" action="{{ url_for('upload') }}">
    <!-- Alterado para m√∫ltiplos arquivos -->
    <input type="file" name="files[]" id="file-upload" accept=".pdf" multiple required style="display: none;">
    
    <label for="file-upload" class="upload-btn">
        üìÅ Anexar contracheques
    </label>
    
    <div id="file-names" class="file-name">Nenhum arquivo selecionado</div>
    
    <button type="submit" class="process-btn" id="submit-btn">
        Processar
    </button>
</form>
        </div>
        
        {% if arquivos_processados and resultados %}
        <div class="resultados-container">
            <h2>Resultados do Processamento</h2>
            
            <div class="resumo-container">
                <div class="resumo-item">
                    <h3>Total de Proventos</h3>
                    <p>R$ {{ "%.2f"|format(resultados.total_proventos) }}</p>
                </div>
                
                <div class="resumo-item">
                    <h3>Arquivos Processados</h3>
                    <p>{{ resultados.quantidade_arquivos }}</p>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const fileInput = document.getElementById('file-upload');
    const fileNamesDiv = document.getElementById('file-names');
    const submitBtn = document.getElementById('submit-btn');
    const feedbackDiv = document.getElementById('upload-feedback');
    const form = document.getElementById('upload-form');

    // Novo c√≥digo para mostrar m√∫ltiplos arquivos
    fileInput.addEventListener('change', function(e) {
        const files = e.target.files;
        
        if (files.length > 0) {
            let html = `<strong>${files.length} arquivo(s) selecionado(s):</strong><ul>`;
            Array.from(files).forEach(file => {
                html += `<li>${file.name}</li>`;
            });
            html += '</ul>';
            fileNamesDiv.innerHTML = html;
            fileNamesDiv.style.color = '#224aa2'; // Azul da Maida
        } else {
            fileNamesDiv.textContent = 'Nenhum arquivo selecionado';
            fileNamesDiv.style.color = '#666'; // Cinza
        }
    });

    // Mantendo a valida√ß√£o existente
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        if (!fileInput.files || fileInput.files.length === 0) {
            showFeedback('Selecione pelo menos um arquivo PDF antes de processar', 'error');
            return;
        }

        // Verifica se todos os arquivos s√£o PDF
        const invalidFiles = Array.from(fileInput.files).filter(
            file => !file.name.toLowerCase().endsWith('.pdf')
        );
        
        if (invalidFiles.length > 0) {
            showFeedback('Apenas arquivos PDF s√£o permitidos', 'error');
            return;
        }

        // Mostra loading
        submitBtn.disabled = true;
        submitBtn.innerHTML = `
            <span class="spinner"></span> Processando...
        `;

        // Envia o formul√°rio
        this.submit();
    });

    function showFeedback(message, type) {
        feedbackDiv.textContent = message;
        feedbackDiv.className = `feedback-message ${type}`;
    }
});
</script>
{% endblock %}
