{% extends "base.html" %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/inicio.css') }}">
<style>
    .calculator-container {
        background: white;
        border-radius: 15px;
        padding: 40px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        width: 90%;
        max-width: 600px;  /* Largura mais estreita para melhor leitura */
        margin: 40px auto;
        text-align: center;  /* Centraliza todo o conte√∫do */
    }
    
    .calculator-header {
        margin-bottom: 30px;
    }
    
    .calculator-header h1 {
        color: var(--maida-azul);
        font-size: 2rem;
        margin-bottom: 5px;  /* Espa√ßo reduzido */
    }
    
    .calculator-header p {
        color: #666;
        font-size: 1rem;
        margin-bottom: 30px;
    }
    
    .upload-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 15px;
        margin-top: 20px;
    }
    
    .file-name {
        color: #666;
        font-size: 0.9rem;
        margin: 10px 0;
    }
</style>
{% endblock %}

{% block content %}
<div class="page-inicio">
    <div class="calculator-container">
        <div class="calculator-header">
            <h1>√Årea ACR</h1>
            <p>Anexe os contracheques</p>  <!-- Texto simplificado -->
        </div>
        
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                <div class="alert-messages">
                    {% for message in messages %}
                        <div class="alert">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
        
        <div class="upload-container">
            <form action="{{ url_for('upload') }}" method="post" enctype="multipart/form-data" id="upload-form">
                <input type="file" name="files" id="file-upload" multiple hidden aria-label="Selecionar arquivos" />
                <label for="file-upload" class="upload-btn">üìÅ Escolher Arquivos PDF</label>
                <p id="file-name" class="file-name">Nenhum arquivo selecionado</p>
                <button type="button" class="process-btn">Processar</button>
                <progress id="upload-progress" value="0" max="100" hidden></progress>
            </form>
        </div>
    </div>
</div>

<!-- Mantenha o mesmo JavaScript -->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const fileInput = document.getElementById('file-upload');
        const fileNameText = document.getElementById('file-name');
        const processBtn = document.querySelector('.process-btn');
        const uploadForm = document.getElementById('upload-form');

        // Atualiza o texto ao selecionar arquivos
        fileInput.addEventListener('change', function() {
            if (this.files.length === 0) {
                fileNameText.textContent = 'Nenhum arquivo selecionado';
                return;
            }
            
            // Verifica se todos s√£o PDFs
            const invalidFiles = Array.from(this.files).filter(file => file.type !== 'application/pdf');
            if (invalidFiles.length > 0) {
                fileNameText.textContent = 'Por favor, selecione apenas arquivos PDF.';
                this.value = '';
                return;
            }
            
            // Atualiza mensagem com nome/quantidade de arquivos
            fileNameText.textContent = this.files.length === 1 
                ? `1 arquivo selecionado: ${this.files[0].name}` 
                : `${this.files.length} arquivos selecionados`;
        });

        // Valida√ß√£o ao clicar em Processar
        processBtn.addEventListener('click', function() {
            if (!fileInput.files || fileInput.files.length === 0) {
                fileNameText.textContent = 'Por favor, selecione pelo menos um arquivo PDF.';
                return;
            }
            
            // Feedback visual durante o processamento
            this.disabled = true;
            this.innerHTML = `
                <div class="spinner-container">
                    <span class="spinner"></span> Processando...
                </div>
            `;
            
            // Submete o formul√°rio
            uploadForm.submit(); 
        });
    });
</script>
{% endblock %}
