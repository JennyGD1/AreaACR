{% extends "base.html" %}

{% block content %}
<div class="container">
    <h1>Análise Detalhada</h1>
    
    <div class="filtros-container mb-4">
        <div class="btn-group" role="group">
            <button type="button" class="btn btn-primary active" data-tipo="descontos">Descontos</button>
            <button type="button" class="btn btn-secondary" data-tipo="proventos">Proventos</button>
        </div>
    </div>

    <!-- Tabela de Descontos (padrão) -->
    <div id="tabela-descontos" class="tabela-container">
        <h3>Descontos por Mês</h3>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>MÊS/ANO</th>
                    {% for codigo in resultados.colunas_descontos|sort %}
                    <th>{{ CODIGOS[codigo]['descricao'] }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for mes in resultados.meses_ordenados %}
                <tr>
                    <td>{{ mes }}</td>
                    {% for codigo in resultados.colunas_descontos|sort %}
                    <td>R$ {{ "%0.2f"|format(resultados.descontos[mes].get(codigo, 0.0))|replace(".", ",") }}</td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Tabela de Proventos (oculta inicialmente) -->
    <div id="tabela-proventos" class="tabela-container" style="display: none;">
        <h3>Proventos por Mês</h3>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>MÊS/ANO</th>
                    {% for codigo in resultados.colunas_proventos|sort %}
                    <th>{{ CODIGOS[codigo]['descricao'] }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for mes in resultados.meses_ordenados %}
                <tr>
                    <td>{{ mes }}</td>
                    {% for codigo in resultados.colunas_proventos|sort %}
                    <td>R$ {{ "%0.2f"|format(resultados.proventos[mes].get(codigo, 0.0))|replace(".", ",") }}</td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Alternar entre proventos e descontos
    document.querySelectorAll('[data-tipo]').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('[data-tipo]').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            if (this.dataset.tipo === 'proventos') {
                document.getElementById('tabela-descontos').style.display = 'none';
                document.getElementById('tabela-proventos').style.display = 'block';
            } else {
                document.getElementById('tabela-descontos').style.display = 'block';
                document.getElementById('tabela-proventos').style.display = 'none';
            }
        });
    });
});
</script>
{% endblock %}
{% endblock %}
