<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>游댧 An치lise Avan칞ada de Descontos</title>
    <link rel="icon" href="{{ url_for('static', filename='img/logo_maida.png') }}" />
    
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components/navbar.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/pages/analise.css') }}">
</head>
<body class="page-analise">
    {% include 'components/_preloader.html' %}
    {% include 'components/_navbar.html' %}

    <div class="scrollbar-container">
        <div class="scrollbar-thumb" id="scrollThumb"></div>
    </div>
    
    <div class="container">
        <h1>游댧 An치lise Avan칞ada</h1>
        <p>An치lise de m칰ltiplos dependentes e linha do tempo das cobran칞as, com base nos arquivos enviados.</p>
        
        {% if dados_analisados %}
            {% for ano in anos_ordenados %}
                <div class="ano-container">
                    <h2>Ano: {{ ano }}</h2>
                    
                    {% set analise_do_ano = dados_analisados[ano]['analise_descontos'] %}
                    
                    {% for rubrica, meses in analise_do_ano.items()|sort %}
                        <div class="rubrica-card">
                            <div class="rubrica-title">
                                {{ descricao_rubricas.get(rubrica, rubrica|title) }}
                                <span class="info-icon" title="An치lise da rubrica {{ rubrica }}">i</span>
                            </div>

                            <div class="timeline">
                                {% for mes_num in range(1, 13) %}
                                    {% set mes_nome_completo = none %}
                                    {% set dados_mes = none %}

                                    {% for mes_key, mes_data in meses.items() if (mes_key.split('/')[0] | replace('Janeiro', '1') | replace('Fevereiro', '2') | replace('Mar칞o', '3') | replace('Abril', '4') | replace('Maio', '5') | replace('Junho', '6') | replace('Julho', '7') | replace('Agosto', '8') | replace('Setembro', '9') | replace('Outubro', '10') | replace('Novembro', '11') | replace('Dezembro', '12'))|int == mes_num %}
                                        {% set mes_nome_completo = mes_key %}
                                        {% set dados_mes = mes_data %}
                                    {% endfor %}

                                    <div class="month-indicator {{ 'present' if dados_mes else 'absent' }}">
                                        {{ ["Jan", "Fev", "Mar", "Abr", "Mai", "Jun", "Jul", "Ago", "Set", "Out", "Nov", "Dez]"][mes_num-1] }}/{{ ano[2:] }}
                                        
                                        {% if dados_mes and dados_mes.pessoas %}
                                            {% if dados_mes.pessoas == 'X' %}
                                                <span class="people-count error" title="Valor n칚o corresponde a m칰ltiplos exatos">X</span>
                                            {% elif dados_mes.pessoas > 1 %}
                                                <span class="people-count">{{ dados_mes.pessoas }}</span>
                                            {% endif %}
                                        {% endif %}
                                        
                                        <div class="tooltip">
                                            {% if dados_mes %}
                                                {{ mes_nome_completo }}: R$ {{ "%.2f"|format(dados_mes.valor) }}
                                                {% if dados_mes.pessoas != 'X' and dados_mes.pessoas > 1 %}
                                                    ({{ dados_mes.pessoas }} pessoas)
                                                {% endif %}
                                            {% else %}
                                                N칚o cobrado
                                            {% endif %}
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% endfor %}
        {% else %}
            <p>Nenhuma an치lise dispon칤vel. Processe os arquivos primeiro.</p>
        {% endif %}

        <div class="btn-container">
            <a href="{{ url_for('mostrar_resultados') }}" class="btn btn-secondary">
                游늵 Voltar ao Resumo
            </a>
        </div>
    </div>
    
    {% include 'components/_footer.html' %}
    <script src="{{ url_for('static', filename='js/main.js') }}" defer></script>
</body>
</html>

