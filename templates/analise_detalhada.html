{% extends "base.html" %}

{% block title %}Análise Detalhada{% endblock %}
{% block body_class %}page-analise{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/analise.css') }}">
{% endblock %}

{% block content %}
<div class="container">
    <h1>Análise Detalhada</h1>

    <div id="painelControle">
        <h2>Filtros</h2>
        <div class="filtros-container">
            <div class="filtro-item">
                <label for="filtroAno">Ano:</label>
                <select id="filtroAno">
                    <option value="todos">Todos</option>
                    {% for ano in anos_disponiveis %}
                    <option value="{{ ano }}">{{ ano }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="filtro-item">
                <label for="filtroRubrica">Rubrica:</label>
                <select id="filtroRubrica">
                    <option value="todos">Todas</option>
                    {% for codigo, descricao in rubricas_detalhadas.items() %}
                    <option value="{{ codigo }}">{{ descricao }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
    </div>

    <div class="tabela-container">
        <table class="tabela-analise">
            <thead>
                <tr>
                    <th>MÊS/ANO</th>
                    {% for coluna_key in colunas_ordenadas %}
                        <th>{{ descricao_rubricas.get(coluna_key, coluna_key.upper()) }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for item in dados_tabela %}
                <tr>
                    <td>{{ item.competencia }}</td>
                    {% for coluna_key in colunas_ordenadas %}
                        <td>
                            {{ "R$ {:,.2f}".format(item.get(coluna_key, 0.0)).replace(",", "X").replace(".", ",").replace("X", ".") }}
                        </td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="btn-container">
        <a href="{{ url_for('calculadora_index') }}" class="btn btn-primary">
            <i class="fas fa-arrow-left"></i> Voltar
        </a>
        <button onclick="exportarParaExcel()" class="btn btn-success">
            <i class="fas fa-file-excel"></i> Exportar para Excel
        </button>
    </div>
</div>

<script>
function exportarParaExcel() {
    // Implementar lógica de exportação
    alert("Exportação para Excel será implementada aqui");
}

// Filtros
document.getElementById('filtroAno').addEventListener('change', filtrarTabela);
document.getElementById('filtroRubrica').addEventListener('change', filtrarTabela);

function filtrarTabela() {
    const anoSelecionado = document.getElementById('filtroAno').value;
    const rubricaSelecionada = document.getElementById('filtroRubrica').value;
    
    // Implementar lógica de filtro
    console.log(`Filtrar por ano: ${anoSelecionado}, rubrica: ${rubricaSelecionada}`);
}
</script>
{% endblock %}
