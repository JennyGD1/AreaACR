<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>游댧 An치lise Avan칞ada de Descontos</title>
    <link rel="icon" href="{{ url_for('static', filename='img/logo_maida.png') }}" />
    
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components/navbar.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/pages/analise.css') }}">
</head>
<body class="page-analise">
    {% include 'components/_preloader.html' %}
    {% include 'components/_navbar.html' %}

    <div class="scrollbar-container">
        <div class="scrollbar-thumb" id="scrollThumb"></div>
    </div>
    
    <div class="container">
        <h1>游댧 An치lise Avan칞ada de Descontos</h1>
        <p>An치lise de m칰ltiplos dependentes e linha do tempo das cobran칞as, com base nos arquivos enviados.</p>
        
        {% if dados_analisados %}
            {% for ano in anos_ordenados %}
                <div class="ano-container">
                    <h2>Ano: {{ ano }}</h2>
                    
                    {% set analise_do_ano = dados_analisados[ano]['analise_descontos'] %}
                    
                    {% set ordem_descontos = [
                        "titular", "parcela_risco_titular", 
                        "conjuge", "parcela_risco_conjuge", 
                        "dependente", "parcela_risco_dependente", 
                        "agregado_jovem", 
                        "agregado_maior", 
                        "parcela_risco_agregado",
                        "plano_especial", "coparticipacao", "retroativo"
                    ] %}

                    {% for rubrica in ordem_descontos %}
                        {% if rubrica in analise_do_ano %}
                            {% set meses = analise_do_ano[rubrica] %}
                            <div class="rubrica-card">
                                <div class="rubrica-title">
                                    {{ descricao_rubricas.get(rubrica, rubrica|replace('_', ' ')|title) }}
                                    <span class="info-icon" title="An치lise da rubrica {{ rubrica }}">i</span>
                                </div>

                                <div class="timeline">
                                    {% set meses_nomes = ["Janeiro", "Fevereiro", "Mar칞o", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"] %}
                                    {% for i in range(12) %}
                                        {% set mes_nome_ano = meses_nomes[i] + '/' + ano %}
                                        {% set dados_mes = meses.get(mes_nome_ano) %}

                                        <div class="month-indicator {{ 'present' if dados_mes else 'absent' }}">
                                            {{ meses_nomes[i][:3] }}/{{ ano[2:] }}
                                            
                                            {% if dados_mes and dados_mes.pessoas %}
                                                {% if dados_mes.pessoas == 'X' %}
                                                    <span class="people-count error" title="Valor n칚o corresponde a m칰ltiplos exatos">X</span>
                                                {% elif dados_mes.pessoas > 1 %}
                                                    <span class="people-count">{{ dados_mes.pessoas }}</span>
                                                {% endif %}
                                            {% endif %}
                                            
                                            <div class="tooltip">
                                                {% if dados_mes %}
                                                    {{ mes_nome_ano }}: R$ {{ "%.2f"|format(dados_mes.valor) }}
                                                    {% if dados_mes.pessoas != 'X' and dados_mes.pessoas > 1 %}
                                                        ({{ dados_mes.pessoas }} pessoas)
                                                    {% endif %}
                                                {% else %}
                                                    N칚o cobrado
                                                {% endif %}
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>
            {% endfor %}
        {% else %}
            <p>Nenhuma an치lise dispon칤vel. Processe os arquivos primeiro.</p>
        {% endif %}

        <div class="btn-container">
            <a href="{{ url_for('mostrar_resultados') }}" class="btn btn-secondary">
                游늵 Voltar ao Resumo
            </a>
        </div>
    </div>
    
    {% include 'components/_footer.html' %}
    <script src="{{ url_for('static', filename='js/main.js') }}" defer></script>
</body>
</html>
