<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ”¬ Tabela Geral de Descontos</title>
    <link rel="icon" href="{{ url_for('static', filename='img/logo_maida.png') }}" />
    
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components/navbar.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/pages/analise.css') }}">
</head>
<body class="page-analise">
    {% include 'components/_preloader.html' %}
    {% include 'components/_navbar.html' %}

    <div class="scrollbar-container">
        <div class="scrollbar-thumb" id="scrollThumb"></div>
    </div>
    
    <div class="container">
        <h1>ðŸ”¬ Tabela Geral de Descontos</h1>
        <p>Tabela detalhada de descontos por competÃªncia, com base nos arquivos enviados.</p>
        
        <div class="tabela-container">
            {% if todas_competencias %}
                <table class="tabela-analise">
                    <thead>
                        <tr>
                            <th>MÃªs/Ano</th>
                            {% for chave in colunas_ordenadas %}
                                <th>{{ descricao_rubricas.get(chave, chave|replace('_', ' ')|title) }}</th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for comp in todas_competencias %}
                        <tr>
                            <!-- Formata a data para MM/YYYY -->
                            <td>{{ comp.competencia.replace('Janeiro', '01').replace('Fevereiro', '02').replace('MarÃ§o', '03').replace('Abril', '04').replace('Maio', '05').replace('Junho', '06').replace('Julho', '07').replace('Agosto', '08').replace('Setembro', '09').replace('Outubro', '10').replace('Novembro', '11').replace('Dezembro', '12').replace(' ', '/') }}</td>
                            {% for chave in colunas_ordenadas %}
                                <!-- Usa .get() para buscar o valor de forma segura e formata como moeda -->
                                <td>{{ "R$ %.2f"|format(comp.get(chave, 0.0))|replace('.', ',') }}</td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p>Nenhuma anÃ¡lise disponÃ­vel. Processe os arquivos primeiro.</p>
            {% endif %}
        </div>
        
        <div class="btn-container">
            <a href="{{ url_for('mostrar_resultados') }}" class="btn btn-secondary">
                ðŸ“Š Voltar ao Resumo
            </a>
        </div>
    </div>
    
    {% include 'components/_footer.html' %}
    <script src="{{ url_for('static', filename='js/main.js') }}" defer></script>
</body>
</html>
